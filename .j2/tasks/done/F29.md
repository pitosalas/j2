# F29 — `/deploy` Clean Export Mode

### T01 — Detect deploy mode in runner.py
**Status**: done
**Description**: In `runner.py`'s `deploy` command handler, detect which mode to use by checking whether a `scaffold/` directory exists in the project root. If present, proceed with existing dev-repo mode (run `install.sh`). If absent, proceed with clean export mode. Pass the detected mode to the template via a new `{{deploy_mode}}` placeholder.

### T02 — Add clean export logic to deploy template
**Status**: done
**Description**: Update `.j2/templates/deploy.md` to handle both modes. In clean export mode, instruct Claude to: create the target directory, copy the entire project to it (using `rsync` or `shutil`), then delete all j2 infrastructure from the copy (`.j2/`, `.claude/`, `scaffold/`, and any `runner.py` at the root). Confirm the result is a clean standalone project.

### T03 — Implement clean export in runner.py
**Status**: done
**Description**: Add a `clean_export(root, target)` function to `runner.py` that: creates the target directory, rsyncs the project excluding j2 paths (`.j2`, `scaffold`, `.claude`), and removes any residual `runner.py` from the target root. Called when deploy mode is `export`. Keep it under 50 lines; use `subprocess` for rsync.

### T04 — Write tests for clean export mode
**Status**: done
**Description**: In the appropriate test file, add tests that: (1) verify `clean_export` copies project files to the target, (2) verify `.j2/`, `scaffold/`, `.claude/`, and `runner.py` are absent from the target, (3) verify the target contains expected project source files. Use `tmp_path` fixtures; do not test rsync failures.
