# F39 — `/milestone` Project-Complete Gate

## Tasks

### T01 — Add no-arg branch to milestone.md template
**Status**: done
**Description**: In `.j2/templates/milestone.md`, add a leading detection step: if no `{{feature_id}}` is provided (i.e. the argument is empty or absent), switch to project-complete gate mode. Otherwise proceed with the existing single-feature milestone flow unchanged.

### T02 — Implement incomplete-feature scan in project-complete gate mode
**Status**: done
**Description**: In the project-complete gate branch of `milestone.md`: scan `features.md` for all features whose status is not `done`. If any are found, output a formatted list (feature ID + name + current status) and exit with the message "Milestone not granted — incomplete features listed above." Make no changes to any files.

### T03 — Implement all-done path: run tests and checkpoint
**Status**: done
**Description**: If all features are `done`, instruct Claude to run `pytest` via bash. If any tests fail, report failures and exit without committing. If all pass, perform the checkpoint steps: write `.j2/current.md` with In Progress / Just Completed / Next Steps / Open Questions sections, run `git add -A`, write a one-line commit message based on `git diff --cached --stat`, commit, and push (set upstream if none).

### T04 — Write tests for project-complete gate behavior
**Status**: done
**Description**: In `tests/test_milestone.py` (create if absent), add: `test_milestone_template_contains_no_arg_detection` (reads `milestone.md`, asserts it contains logic for detecting absent feature ID), `test_milestone_template_contains_incomplete_feature_scan` (asserts keywords like "not done" or "incomplete" appear in the no-arg branch), `test_milestone_template_contains_pytest_call` (asserts `pytest` appears in the all-done branch).
