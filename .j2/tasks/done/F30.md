# F30 — Token Minimization in Templates

## Tasks

### T01 — Remove `{{spec}}` and `{{features}}` from `start_task.md`
**Status**: done
**Description**: Edit `.j2/templates/start_task.md` to remove the `--- SPEC BEGIN ---`/`--- SPEC END ---` and `--- FEATURES BEGIN ---`/`--- FEATURES END ---` blocks. The template already references the task file directly and has `{{rules}}` — spec and features are unnecessary token waste.

### T02 — Remove `{{spec}}` and `{{features}}` from `next_task.md` and use runner for feature/task resolution
**Status**: done
**Description**: Edit `.j2/templates/next_task.md` to remove `{{spec}}` and `{{features}}` injections. The template currently asks Claude to scan features and find the next task — but the runner already has `find_default_feature()`. Refactor: have the runner resolve the feature ID and pass it to the template as `{{feature_id}}`, so the template can reference the task file directly (like `start_task.md` does). Remove the multi-step scanning instructions and replace with a direct "read the task file, find first not-started task, implement it" approach.

### T03 — Add `filter_done_features()` to runner and use it for `{{features}}`
**Status**: done
**Description**: Add a function `filter_done_features(features_text)` to `runner.py` that strips all `## F<N>` sections with `**Status**: done` and appends a one-line summary (e.g. `— 27 completed features omitted —`). Update the `features` loader in `build_context()` to call this filter. This ensures any template using `{{features}}` gets only the incomplete features, saving tokens proportional to the number of done features.

### T04 — Write tests for token minimization changes
**Status**: done
**Description**: Add tests for: (1) `filter_done_features()` correctly strips done entries and adds the summary count, (2) `start_task.md` template no longer contains `{{spec}}` or `{{features}}` placeholders, (3) `next_task.md` template no longer contains `{{spec}}` or `{{features}}` placeholders. Tests go in the existing test files under `tests/`.
